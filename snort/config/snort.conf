# Basic Snort configuration for lab environment

# Define network variables
var HOME_NET 172.20.0.0/16
var EXTERNAL_NET !$HOME_NET
var HTTP_SERVERS $HOME_NET
var HTTP_PORTS 80
var SMTP_SERVERS $HOME_NET
var SMTP_PORTS 25
var SQL_SERVERS $HOME_NET
var SQL_PORTS 1433
var DNS_SERVERS $HOME_NET
var DNS_PORTS 53
var SHELLCODE_PORTS !80

# Configure paths
var RULE_PATH /etc/snort/rules
var SO_RULE_PATH /etc/snort/so_rules
var PREPROC_RULE_PATH /etc/snort/preproc_rules

# Configure the snort decoder
config checksum_mode: all
config disable_decode_alerts
config disable_tcpopt_experimental_alerts
config disable_tcpopt_obsolete_alerts
config disable_ttcp_alerts
config disable_tcpopt_alerts
config disable_ipopt_alerts
config disable_decode_drops

# Configure the detection engine
config detection: search-method ac-split search-optimize max-pattern-len 20
config event_queue: max_queue 8 log 5 order_events content_length

# Configure dynamic loaded libraries (optional)
# dynamicpreprocessor directory /usr/local/lib/snort_dynamicpreprocessor/
# dynamicengine /usr/local/lib/snort_dynamicengine/libsf_engine.so
# dynamicdetection directory /usr/local/lib/snort_dynamicrules/

# Basic preprocessors
preprocessor frag3_global: max_frags 65536
preprocessor frag3_engine: policy first detect_anomalies overlap_limit 10 min_fragment_length 100 timeout 180

preprocessor stream5_global: track_tcp yes, track_udp yes, track_icmp no, max_tcp 262144, max_udp 131072
preprocessor stream5_tcp: policy first, use_static_footprint_sizes, detect_anomalies, require_3whs 180, overlap_limit 10, timeout 180

# Configure output plugins
output alert_fast: alerts.txt
output log_tcpdump: snort.log

# Include rules
include $RULE_PATH/local.rules
include $RULE_PATH/lab.rules
