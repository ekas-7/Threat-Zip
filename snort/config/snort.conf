# Snort configuration file for lab environment

# Define network variables
var HOME_NET 172.20.0.0/16
var EXTERNAL_NET !$HOME_NET
var HTTP_SERVERS $HOME_NET
var HTTP_PORTS 80
var SMTP_SERVERS $HOME_NET
var SMTP_PORTS 25
var SQL_SERVERS $HOME_NET
var SQL_PORTS 1433
var DNS_SERVERS $HOME_NET
var DNS_PORTS 53
var SHELLCODE_PORTS !80

# Configure paths
var RULE_PATH /etc/snort/rules
var SO_RULE_PATH /etc/snort/so_rules
var PREPROC_RULE_PATH /etc/snort/preproc_rules

# Configure the snort decoder
config checksum_mode: all
config disable_decode_alerts
config disable_tcpopt_experimental_alerts
config disable_tcpopt_obsolete_alerts
config disable_ttcp_alerts
config disable_tcpopt_alerts
config disable_ipopt_alerts
config disable_decode_drops

# Configure the detection engine
config detection: search-method ac-split search-optimize max-pattern-len 20
config event_queue: max_queue 8 log 5 order_events content_length

# Configure dynamic loaded libraries
dynamicpreprocessor directory /usr/local/lib/snort_dynamicpreprocessor/
dynamicengine /usr/local/lib/snort_dynamicengine/libsf_engine.so
dynamicdetection directory /usr/local/lib/snort_dynamicrules/

# Configure preprocessors
preprocessor frag3_global: max_frags 65536
preprocessor frag3_engine: policy windows detect_anomalies overlap_limit 10 min_fragment_length 100 timeout 180

preprocessor stream5_global: track_tcp yes, track_udp yes, track_icmp no, max_tcp 262144, max_udp 131072, max_active_responses 2, min_response_seconds 5
preprocessor stream5_tcp: policy windows, detect_anomalies, require_3whs 180, overlap_limit 10, small_segments 3 bytes 150, timeout 180, ports client 21 22 23 25 42 53 70 79 109 110 111 113 119 135 136 137 139 143 161 993 995 1024:, ports both 443 465 563 636 989 992 993 994 995

preprocessor http_inspect_server: server default \
    chunk_length 500000 \
    server_flow_depth 0 \
    client_flow_depth 0 \
    post_depth 65495 \
    oversize_dir_length 500 \
    max_header_length 750 \
    max_headers 100 \
    enable_cookie \
    extended_response_inspection \
    inspect_gzip \
    normalize_utf \
    unlimited_decompress \
    normalize_javascript \
    apache_whitespace no \
    ascii no \
    bare_byte no \
    base36 no \
    double_decode no \
    iis_unicode no \
    multi_slash no \
    utf_8 no \
    u_encode yes \
    whitespace_chars 0x9 0xb 0xc 0xd

# Configure output plugins
output alert_fast: alerts.txt
output log_tcpdump: snort.log

# Include rules
include $RULE_PATH/local.rules
include $RULE_PATH/lab.rules
